{% extends "base.html" %}
{% block title %}Historique - {{ template.name }}{% endblock %}
{% block content %}
<nav aria-label="breadcrumb" class="mb-3">
  <ol class="breadcrumb">
    <li class="breadcrumb-item"><a href="{{ url_for('machines') }}">Machines</a></li>
    <li class="breadcrumb-item"><a href="{{ url_for('machine_detail', machine_id=machine.id) }}">{{ machine.name }}</a></li>
    <li class="breadcrumb-item active">Historique - {{ template.name }}</li>
  </ol>
</nav>

<h2>Historique : {{ template.name }}</h2>

{% if instances %}
<div class="list-group">
  {% for instance in instances %}
  <a href="{{ url_for('checklist_instance_detail', machine_id=machine.id, template_id=template.id, instance_id=instance.id) }}" class="list-group-item list-group-item-action">
    <div class="d-flex justify-content-between align-items-start">
      <div class="flex-grow-1">
        <strong>Check list remplie</strong>
        <div class="text-muted small mt-1">
          {% set checked_count = instance.values|selectattr('checked', 'equalto', true)|list|length %}
          {{ checked_count }}/{{ template.items|length }} élément(s) cochés
        </div>
      </div>
      <small class="text-muted">
        {{ instance.created_at.strftime("%d/%m/%Y %H:%M") }}
        {% if instance.user %}
        · {{ instance.user.username }}
        {% endif %}
      </small>
    </div>
  </a>
  {% endfor %}
</div>
{% else %}
<p class="text-muted mb-0 text-center py-3">Aucun remplissage enregistré pour cette check list.</p>
{% endif %}

<div class="mt-3">
  <a href="{{ url_for('machine_detail', machine_id=machine.id) }}" class="btn btn-secondary">Retour</a>
</div>
{% endblock %}

